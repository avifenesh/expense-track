# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Changed

- Pricing: Updated from $5/month to $3/month (#274)
  - Reduced subscription price constant to 300 cents ($3.00)
  - Updated pricing display across all pages
  - Updated legal terms and documentation

### Added

- Web: Public Help Center at /help route (#99)
  - 52 FAQs organized across 12 categories (getting-started, transactions, budgets, categories, recurring, holdings, sharing, currency, subscription, privacy, mobile, account-management)
  - 28 comprehensive help articles with summaries and full content
  - Search functionality with fuzzy matching and relevance scoring
  - Individual article pages at /help/[slug] with related content
  - FAQ accordion component with expand/collapse animation
  - Help link added to footer and dashboard settings menu
  - Static content in src/lib/help-content.ts (no database required)
  - Search utilities in src/lib/help-search.ts with 98%+ test coverage
- API: POST /api/v1/accounts/[id]/set-balance endpoint for setting account balance (#205)
  - Set account balance to a specific target amount for a given month
  - Automatically creates "Balance Adjustment" category if needed
  - Calculates adjustment (positive or negative) to reach target balance
  - Creates INCOME or EXPENSE transaction based on adjustment direction
  - Skips adjustment if difference is less than $0.01
  - Invalidates dashboard cache after balance update
  - JWT authentication and active subscription required
  - Comprehensive test suite with 90%+ coverage
- API: POST /api/v1/expenses/shares/[participantId]/remind endpoint for payment reminders (#189)
  - Send payment reminders to participants with pending shares
  - 24-hour cooldown per participant (max 1 reminder per day)
  - Owner-only authorization - participants cannot send reminders
  - Status validation - only PENDING shares can be reminded
  - Email notification sent to participant
  - Updates reminderSentAt timestamp on ExpenseParticipant
  - Comprehensive test suite with 12 tests
- Mobile: Settings subscription status section (#316)
  - Display subscription status with color-coded badge (TRIALING, ACTIVE, PAST_DUE, CANCELED, EXPIRED)
  - Show days remaining for active subscriptions and trials
  - Manage Subscription button opens Paddle customer portal (for ACTIVE, PAST_DUE, CANCELED)
  - Upgrade button opens pricing page (for TRIALING)
  - Loading and error states for subscription data fetching
  - Added PADDLE_CUSTOMER_PORTAL_URL constant to mobile/src/constants/index.ts
  - Integration with subscriptionStore for real-time subscription state
  - Comprehensive test suite with 60 tests

- Mobile: PaywallScreen for subscription expiration (#317)
  - New PaywallScreen component shown when user's subscription has expired
  - Subscribe button opens balancebeacon.com/pricing in browser
  - Sign out button to logout from expired account
  - useSubscriptionState hook for navigation access control
  - RootNavigator integration with subscription checking logic
  - Lenient offline behavior - network errors don't block app access
  - Loading screen while subscription initializes (if no cached data)
  - Paywall only shown when subscription is explicitly expired
  - Full accessibility support with ARIA labels
  - Comprehensive test suite with 95%+ coverage
- Mobile: AccountsScreen for managing accounts (#302)
  - View all user accounts with calculated balances
  - Switch between accounts (e.g., personal, shared)
  - Edit account names with validation
  - Delete accounts with safety checks (cannot delete only/active account)
  - Pull-to-refresh functionality
  - Loading states with activity indicator
  - Integration with accountsStore for real-time data
  - Navigation from Settings screen
- API: DELETE /api/v1/auth/account endpoint for GDPR-compliant account deletion (#243)
- Mobile: Settings Export Data and Delete Account buttons (#303)
  - Export Data button opens modal to select JSON or CSV format
  - Export includes all user data (transactions, budgets, categories, accounts, holdings, recurring templates)
  - Delete Account button opens confirmation modal with email verification
  - Warning modal shows all data that will be deleted
  - New ExportFormatModal component with format selection
  - New DeleteAccountModal component with email confirmation input
  - Integration with exportUserData() and deleteAccount() auth service functions
  - GDPR compliance (Article 20 - data portability, right to deletion)
  - Rate limited endpoints (3 requests per hour)
  - Soft-delete user accounts with email confirmation
  - Anonymizes personal data (email, display name, password)
  - Deletes all refresh tokens for user
  - Cancels Paddle subscription if active
  - Rate limited (3 requests per hour)
  - JWT authentication required
  - Comprehensive test suite with 21 tests
- API: GET /api/v1/auth/export endpoint for GDPR-compliant data export (#244)
  - Export all user data in JSON or CSV format
  - Supports GDPR Article 20 - Right to data portability
  - Returns user profile, subscription, accounts, categories, transactions, budgets, holdings, recurring templates
  - Rate limited (3 requests per hour)
  - JWT authentication required
  - Comprehensive test suite with 42 tests
- API: Enhanced GET /api/v1/accounts endpoint (#302)
  - Now returns calculated `balance` field for each account
  - Balance = Total Income - Total Expenses
  - Aggregated from all non-deleted transactions
- API: PUT /api/v1/accounts/[id] endpoint for updating account names (#302)
  - Update account name with validation (1-50 characters)
  - Duplicate name detection across user's accounts
  - JWT authentication and active subscription required
- API: DELETE /api/v1/accounts/[id] endpoint for soft-deleting accounts (#302)
  - Soft delete accounts (sets deletedAt timestamp)
  - Safety checks: cannot delete only account or active account
  - Preserves related data (transactions, budgets)
  - JWT authentication and active subscription required
- Mobile: AddBudgetScreen for creating and updating budgets (#216)
  - Modal screen for budget creation with month selector and category picker
  - Amount input with currency formatting and real-time validation
  - Auto-population for editing existing budgets (upsert behavior)
  - Filtered category list showing only expense categories
  - Integration with budgetsStore.createOrUpdateBudget
  - Navigation from BudgetsScreen FAB
  - Budget validation utilities (validateBudgetAmount, validateBudgetCategory)
  - Comprehensive test suite with 95%+ coverage
- Mobile: ShareExpenseScreen for creating shared expenses (#218)
  - Multi-step form: expense details, participant selection, split configuration
  - User lookup by email (GET /api/v1/users/lookup)
  - Three split types: EQUAL (auto-calculate), PERCENTAGE (% per person), FIXED (amount per person)
  - Real-time validation (at least 1 participant, splits must sum to total, percentages to 100%)
  - Split preview showing amounts per participant and owner share
  - TransactionPickerModal component for selecting existing transactions
  - Split calculator utility module with comprehensive validation
  - Integration with sharingStore.createSharedExpense
  - Navigation from SharingScreen FAB
- API: GET /api/v1/users/lookup endpoint for user lookup (#218, #188)
  - Lookup user by email for expense sharing
  - Returns user ID, email, display name
  - Prevents self-lookup
  - Case-insensitive email matching
  - Rate limited (5 requests/minute)
  - JWT authentication required
- Web: Enhanced pricing page with feature comparison table (#274)
  - Free trial vs Premium comparison table
  - Visual feature breakdown with checkmarks
  - Back navigation to app
  - Pricing page E2E test suite
  - Comprehensive unit tests for comparison table
- Mobile: Subscription service for checking user subscription status (#319)
  - New `services/subscription.ts` with getSubscriptionStatus() function
  - TypeScript types for subscription status, checkout info, and pricing info
  - Integrates with GET /api/v1/subscriptions endpoint
  - Returns subscription state (TRIALING, ACTIVE, PAST_DUE, CANCELED, EXPIRED)
  - Includes Paddle checkout configuration and pricing details
  - Comprehensive test suite with 90%+ coverage
- Mobile: subscriptionStore for client-side subscription state management (#318)
  - New `stores/subscriptionStore.ts` Zustand store for subscription state
  - New `lib/subscriptionPersistence.ts` for AsyncStorage caching
  - Manages subscription status (TRIALING, ACTIVE, PAST_DUE, CANCELED, EXPIRED)
  - Smart caching with 5-minute TTL to reduce API load
  - Instant app start with cached data and background refresh
  - Integrates with GET /api/v1/subscriptions endpoint
  - Store registry integration for logout cleanup
  - Comprehensive test suite with 95%+ coverage

- Mobile: Skeleton loading components for all main screens (#227)
  - Base Skeleton component with animated pulsing opacity effect
  - DashboardScreenSkeleton with stat cards and transactions
  - TransactionsScreenSkeleton with date sections and transaction items
  - BudgetsScreenSkeleton with budget progress and category cards
  - SharingScreenSkeleton with balance and shared expense cards
  - Atomic skeleton components (SkeletonStatCard, SkeletonBudgetCategoryCard, etc.)
  - Integrated into Dashboard, Transactions, Budgets, and Sharing screens
  - Consistent loading experience matching actual content structure
  - Comprehensive test suite with 100% coverage for skeleton components

### Fixed

- Web: E2E test locator fixes and improvements (#263)
  - Fixed 45+ flaky test locators across 8 spec files
  - Settings tests refactored to use account dropdown menu (not /settings page)
  - Replaced all `waitForTimeout` calls with proper explicit waits
  - Re-enabled E2E CI workflow for pull requests
  - Updated test counts: 68 total tests (was 45)
  - Added architecture notes to E2E documentation

- Web: Comprehensive E2E test suite with Playwright (#261)
  - 45 web E2E tests covering authentication, onboarding, transactions, budgets, sharing, dashboard, settings, subscription
  - Page Object Model pattern for test organization
  - Auth helpers and test fixtures for reusable flows
  - E2E database seeding script with test data
  - GitHub Actions CI workflow for automated testing
  - Comprehensive E2E documentation at tests/e2e/README.md
- Mobile: MonthSelector component for month navigation (#223)
  - Previous/next arrow buttons for month navigation
  - Tap on month label opens modal picker
  - Modal with year selector and month grid (4 columns x 3 rows)
  - Support for min/max month boundaries
  - Optional future month selection with allowFutureMonths prop
  - Configurable year range for picker
  - Disabled state for navigation buttons at boundaries
  - Full accessibility support with proper labels and states
  - Month utility functions (formatMonthLabel, shiftMonth, compareMonths, etc.)
  - Comprehensive test suite with 95%+ coverage
- Mobile: SharingScreen with expense sharing UI (#217)
  - Net balance summary showing overall settlements
  - View expenses shared by you with payment status tracking
  - View expenses shared with you by others
  - Pull-to-refresh functionality
  - Loading and error states
  - Empty state when no shared expenses exist
  - Integration with sharingStore for real-time data
  - Settlement balance display per contact
- API: GET /api/v1/sharing endpoint for retrieving all sharing data (#217)
  - Returns expenses shared by user
  - Returns expenses shared with user
  - Returns settlement balances with each contact
  - JWT authentication required
- API: PATCH /api/v1/sharing/[participantId]/paid endpoint (#217)
  - Allows expense owner to mark participant payments as received
  - Updates payment status and timestamp
  - JWT authentication required
- API: POST /api/v1/expenses/shares/[participantId]/decline endpoint (#186)
  - Allows participants to decline expense shares assigned to them
  - Optional decline reason field for explanation
  - Updates ExpenseParticipant status to DECLINED with timestamp
  - Authorization check ensures only assigned participant can decline
  - JWT authentication and active subscription required
- Mobile: EditTransactionScreen for editing and deleting transactions (#214)
  - Pre-populated form with existing transaction data
  - Transaction type toggle with visual feedback
  - Category selector filtered by transaction type
  - Date selector with quick options (Today, Yesterday, Custom)
  - Optional description field with character counter
  - Transaction preview showing updated values
  - Delete functionality with confirmation dialog
  - Loading and error states
  - Transaction not found state handling
  - Navigation wired from Dashboard and Transactions screens
  - Integration with PUT and DELETE transaction endpoints
- Mobile: BudgetsScreen with store integration and category list (#215)
  - Real budget data from budgets store
  - Category-specific budget cards with color indicators
  - Progress bars showing spent vs planned amounts
  - Month selector for navigating budget periods
  - Overall budget progress card
  - Pull-to-refresh functionality
  - Loading and error states
  - Empty state when no budgets exist
  - New BudgetCategoryCard component for displaying category budgets

- Mobile: sharingStore for expense splitting (#207)
  - Zustand store for managing shared expenses
  - Support for EQUAL, PERCENTAGE, and FIXED split types
  - Create, update, and delete shared expenses
  - Mark participant shares as paid or declined
  - List expenses shared by user and shared with user
  - Updates local cache after successful API mutations
  - Background refresh after mutations
  - Logout integration for state cleanup
  - 641-line comprehensive test suite with 90%+ coverage

### Fixed

- **E2E Tests**: Fixed mobile E2E test failures caused by infinite render loop in `useSubscriptionState` hook (#315)
  - Fixed `useSubscriptionState` to use individual Zustand selectors instead of returning new object
  - Added PaywallScreen and RootLoadingScreen UI contracts for subscription flow testing
  - Updated `performLogin` helper to properly wait for subscription loading state
  - Added subscription API contracts and verification in TestApiClient
  - Created comprehensive `subscription.e2e.ts` test suite with 7 test cases
  - Adjusted iOS CI timeout to 45 minutes (reasonable safety margin)
  - Created `mobile/e2e/README.md` with comprehensive E2E testing documentation
